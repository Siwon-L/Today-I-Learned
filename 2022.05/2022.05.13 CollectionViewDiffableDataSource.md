# [CollectionViewDiffableDataSource](https://developer.apple.com/documentation/uikit/uicollectionviewdiffabledatasource)
> The object you use to manage data and provide cells for a collection view.
> ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê³  ì»¬ë ‰ì…˜ ë³´ê¸°ì— ëŒ€í•œ ì…€ì„ ì œê³µí•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” ê°œì²´

```swift
@MainActor class UICollectionViewDiffableDataSource<SectionIdentifierType, ItemIdentifierType> : NSObject 
    where SectionIdentifierType : Hashable, ItemIdentifierType : Hashable
```

`DiffableDataSource`ëŠ” iOS13 ì´ìƒì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , `UICollectionViewDataSource`í”„ë¡œí† ì½œì„ ì´ìš©í•´ `DataSource`ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€ì²´ ì—­í• ì„ í•œë‹¤. 

í”„ë¡œí† ì½œì„ ì´ìš©í•˜ëŠ” ë°©ë²•ì€ ë¯¸ë¦¬ Cellì˜ ìˆ˜ì™€ Sectionì˜ ìˆ˜ë¥¼ returnë°›ì•„ Viewë¥¼ êµ¬ì„±í•˜ì§€ë§Œ, `DiffableDataSource`ëŠ” `Snapshot`ì„ í†µí•´ íŠ¹ì • ì‹œì ì— ë°ì´í„° ìƒíƒœë¥¼ ì €ì¥í•˜ê³ , ë°ì´í„° ìƒíƒœì— ë§ê²Œ Cellê³¼ Sectionì„ êµ¬ì„±í•œë‹¤.

`UICollectionViewDataSource`ì„ ì´ìš©í•´ `DataSource`ë¥¼ ê´€ë¦¬í•˜ë©´, ê¸°ë³¸ì ìœ¼ë¡œ `indexPath`ë¥¼ í†µí•´ ìœ„ì¹˜ì— ë§ëŠ” ë°ì´í„°ë¥¼ ì£¼ì…í•˜ëŠ”ë°, ì´ëŸ° ê²½ìš° ë°ì´í„°ì˜ ìƒíƒœì™€ `CollectionView` ìƒíƒœê°€ ë§ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤. í•˜ì§€ë§Œ, `DiffableDataSource`ëŠ” ë°ì´í„° ì¶”ê°€, ì‚­ì œë¡œ ì¸í•´ ë°ì´í„°ê°€ ë³€í•˜ë©´, ê·¸ ì‹œì ì— `Snapshot`ì— ë°ì´í„°ë¥¼ ë‹´ì•„ ë¹„êµí•˜ë©´, ë³€ê²½ëœ ê²ƒë§Œ `DiffableDataSource`ì¸ì§€í•´ì„œ Viewë¥¼ ìˆ˜ì •í•œë‹¤. ë•Œë¬¸ì— ë°ì´í„° ìˆ˜ì •ì„ ì•ˆì „í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

## [NSDiffableDataSourceSnapshot](https://developer.apple.com/documentation/uikit/nsdiffabledatasourcesnapshot)
> A representation of the state of the data in a view at a specific point in time.
> íŠ¹ì • ì‹œì ì—ì„œ ë³´ê¸°ì˜ ë°ì´í„° ìƒíƒœë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

```swift
struct NSDiffableDataSourceSnapshot<SectionIdentifierType, ItemIdentifierType> 
    where SectionIdentifierType : Hashable, ItemIdentifierType : Hashable
```

`Snapshot` ì—­í• ì€ ìœ„ ì–¸ê¸‰ê³¼ ê°™ì´ íŠ¹ì • ì‹œì ì— Sectionê³¼ Cellì— í‘œì‹œë  ë°ì´í„°ì˜ ìƒíƒœë¥¼ ë‹´ê³ ìˆëŠ” ì—­í• ì„ í•œë‹¤. ë°ì´í„°ì˜ ìƒíƒœë¥¼ `Snapshot`ì„ í†µí•´ ì €ì¥í•˜ê³ , `DataSource`ì˜ `Snapshot`ê³¼ ë¹„êµí•´ ë³€ê²½ì‚¬í•­ì„ ì¸ì§€í•œë‹¤.

![](https://i.imgur.com/ECUIY1E.png)

ìœ„ ê·¸ë¦¼ê³¼ ê°™ì´ ìƒˆë¡œìš´ `Snapshot`ê³¼ ê¸°ì¡´ì— `Snapshot`(`DataSource`ì˜ `Snapshot`) ê³¼ ë¹„êµí•´ ë³€ê²½ì‚¬í•­ì„ ì²´í¬í•˜ê³ ,


<img src="https://i.imgur.com/fpoDlvn.png" width="300">

ìœ„ì™€ ê°™ì´ ì—…ë°ì´í„° í•œë‹¤.

## ì½”ë“œë¡œ í•´ë³´ê¸°

ë¨¼ì €, `DiffableDataSource`ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„ ,

```swift
typealias DataSource = UICollectionViewDiffableDataSource<Section, String>
typealias Snapshot = NSDiffableDataSourceSnapshot<Section, String>
```
ìœ„ì™€ ê°™ì´ `DataSource`ì™€ `Snapshot`ì´ í•„ìš”í•˜ë‹¤. ë‘ íƒ€ì…ì€ ì œë„¤ë¦­ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆëŠ”ë° ì•, ë’¤ íƒ€ì… ëª¨ë‘ ì‹ë³„ì(Identifier)ì˜ ì—­í• ì„ í•˜ëŠ” íƒ€ì…ì´ê³ , ëª¨ë‘ `Hashable`ì„ ì±„íƒí•œ íƒ€ì…ì´ ë“¤ì–´ì˜¬ ìˆ˜ ìˆë‹¤. ë•Œë¬¸ì— ì¤‘ë³µëœ ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ë©´, ì‹ë³„í•  ìˆ˜ ì—†ì–´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤. ì´ëŸ¬í•œ ì´ìœ ë¡œ SectionIdentifierëŠ” ì—´ê±°í˜•ìœ¼ë¡œ caseë¥¼ ë§Œë“¤ì–´ ì‹ë³„ìë¡œ ì‚¬ìš©í•˜ê³ , ItemIdentifier ê°™ì€ê²½ìš° `UUID` ê°™ì€ ì‹ë³„ì ì—­í• ì„ í•  ìˆ˜ ìˆëŠ” íƒ€ì…ì´ ë“¤ì–´ì˜¬ ìˆ˜ ìˆë‹¤.(ì‹ë³„ìì˜ ì—­í• ë§Œ í•  ìˆ˜ ìˆìœ¼ë©´, ë¬´ìŠ¨ íƒ€ì…ì´ë“  ìƒê´€ì—†ìŒ)

ê·¸ ë‹¤ìŒìœ¼ë¡œ,

```swift
func applySnapshot() {
    var snapshot = Snapshot()
    snapshot.appendSections(Section.allCases)
    
    snapshot.appendItems(mainData, toSection: .main)
    snapshot.appendItems(secondeData, toSection: .seconde)
    snapshot.appendItems(thirdData, toSection: .third)
    dataSource.apply(snapshot, animatingDifferences: false)
}
```

ë°ì´í„°ë¥¼ ê°€ì§€ê³ , Sectionê³¼, Cellì„ êµ¬ì„±í•  ìˆ˜ ìˆë„ë¡ `Snapshot`ì— ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.

> âš ï¸ ì—¬ê¸°ì„œ í•˜ë‚˜ì˜ ë°ì´í„°ë¥¼ ê°€ì§€ê³ , ê° ì„¸ì…˜ì— `appendItems` í•˜ê²Œë˜ë©´ ë°ì´í„°ê°€ ë“¤ì–´ê°€ì§€ ì•ŠëŠ”ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `mainData`ë§Œì„ ê°€ì§€ê³ , ê° ì„¸ì…˜ì— `appendItems` í•˜ê²Œë˜ë©´ ë°ì´í„°ê°€ ë§ˆì§€ë§‰ ì„¸ì…˜ì—ë§Œ ë³´ì—¬ì§€ëŠ” í˜„ìƒ ë°œìƒ ì´ìœ ëŠ” ëª¨ë¥´ê² ë‹¤. ğŸ˜¢ğŸ˜¢ğŸ˜¢

ë§ˆì§€ë§‰ìœ¼ë¡œ, Cellê³¼ Sectionì„ ê´€ë¦¬í•˜ëŠ” `DataSource`ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ë¡œì§ì„ êµ¬í˜„í•˜ë©´ ë§ˆë¬´ë¦¬!!

``` swift
func makeDataSource() -> DataSource {
    let dataSource = DataSource(collectionView: collectionView) { collectionView, indexPath, itemIdentifier in
        
        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: "cell", for: indexPath) as!
MyCollectionViewCell
        
        cell.backgroundColor = .lightGray
        cell.label.text = itemIdentifier
        cell.imageView.image = UIImage(systemName: itemIdentifier)
        cell.layer.cornerRadius = 10
        cell.backgroundColor = .white
        cell.layer.borderWidth = 1
        cell.layer.borderColor = UIColor.gray.cgColor
        
        return cell
    }// ì—¬ê¸°ê¹Œì§€ 1
    
    dataSource.supplementaryViewProvider = { collectionView, kind, indexPath in
        guard kind == UICollectionView.elementKindSectionHeader else { return nil }
        let view = collectionView.dequeueReusableSupplementaryView(ofKind: kind, withReuseIdentifier: "section", for:
indexPath)
                                            
        let section = self.dataSource.snapshot().sectionIdentifiers[indexPath.section]
        
        return view 
    }// ì—¬ê¸°ê¹Œì§€ 2
    
    return dataSource//ì—¬ê¸°ê¹Œì§€ 3
}
```

ë¨¼ì €,
1. `DataSource` íƒ€ê²Ÿì´ ë  CollectionViewì™€ í´ë¡œì €ë¥¼ ì¸ìë¡œ ê°€ì§„ ìƒì„±ìë¥¼ í†µí•´ Cellì„ ì„¤ì •í•˜ê³  ë°˜í™˜í•´ì¤€ë‹¤. ì—¬ê¸°ì„œ `itemIdentifier`ê°€ `DataSource` ì œë„¤ë¦­ì— ë“¤ì–´ê°€ëŠ” íƒ€ì…ì´ë‹¤. ë•Œë¬¸ì— `itemIdentifier` í†µí•´ ì›í•˜ëŠ” ë°ì´í„°ì— ì ‘ê·¼í•´ Cellì„ êµ¬ì„±í•´ ë°˜í™˜í•œë‹¤.
2. `dataSource.supplementaryViewProvider`ë¡œ ì ‘ê·¼í•´ ì´ë²ˆì—” ë¨¸ë¦¿ê¸€, ë°”ë‹¥ê¸€ viewë¥¼ ì„¤ì •í•´ ë°˜í™˜í•´ì¤€ë‹¤. `kind`ë¥¼ í†µí•´ ë¨¸ë¦¿ê¸€ì¸ì§€ ë°”ë‹¥ê¸€ì¸ì§€ í™•ì¸í•˜ê³ , viewë¥¼ ì¬ì‚¬ìš©ì„ í†µí•´ ë§Œë“¤ì–´ ë°˜í™˜í•œë‹¤.(ìœ„ì™€ ê°™ì´ `self.dataSource.snapshot().sectionIdentifiers[indexPath.section]` í†µí•´ Sectioníƒ€ì…ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.) 
3. ìƒì„±í•œ `DataSource`ë¥¼ ë°˜í™˜í•œë‹¤.

# ì°¸ê³  ìë£Œ, ë¸”ë¡œê·¸

https://zeddios.tistory.com/1197
https://kangheeseon.tistory.com/22
